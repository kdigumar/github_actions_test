name: Deploy Workflow

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string

jobs:
  build-and-deploy:
    runs-on: self-hosted  # Runs directly on your Mac

    env:
      ENV: ${{ inputs.environment }}

    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v3

      - name: Set Up Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Build Project with Maven
        run: |
          echo "Building project using Maven..."
          mvn clean package

      - name: List Target Directory Contents
        run: |
          echo "Listing contents of the ./target directory:"
          ls -lh ./target

      - name: Deploy JAR to Local Directory
        run: |
          JAR_FILE=$(find ./target -name "*.jar" | head -n 1)
          if [[ -z "$JAR_FILE" ]]; then
            echo "JAR file not found! Build may have failed."
            exit 1
          fi

          echo "Found JAR file: $JAR_FILE"
          DEPLOY_DIR="/Users/welcome"
          echo "Deploying to: $DEPLOY_DIR"

          mkdir -p "$DEPLOY_DIR"
          cp "$JAR_FILE" "$DEPLOY_DIR/"

          echo "Deployment complete. Deployed files:"
          ls -lh "$DEPLOY_DIR"
